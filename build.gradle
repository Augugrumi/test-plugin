buildscript {

    repositories {
        mavenCentral()
        mavenLocal()
    }

    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:1.2.3.RELEASE")
    }
}
plugins {
    id "net.saliman.cobertura" version "2.2.8"
}
plugins {
    id 'net.researchgate.release' version '2.0.2'
}
apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'
apply plugin: 'application'
apply plugin: 'spring-boot'


sourceCompatibility = 1.7
targetCompatibility = 1.7
mainClassName = 'org.project.neutrino.nfvo.core.Application'

allprojects {
    task hello << { task -> println "I'm $task.project.name" }
    //Put instructions for all projects
    apply plugin: "java"
    sourceCompatibility = 1.7
    targetCompatibility = 1.7

    repositories {
        mavenCentral()
    }
    dependencies {
        compile("org.springframework.boot:spring-boot:1.2.3.RELEASE")
        compile("org.springframework.boot:spring-boot-starter-logging:1.2.3.RELEASE")
        compile('org.springframework.boot:spring-boot-autoconfigure:1.2.3.RELEASE')
        compile("org.springframework:spring-jms:4.1.6.RELEASE")
        compile("javax.jms:javax.jms-api:2.0.1")
        compile('org.apache.activemq:activemq-broker:5.11.1')
        compile('org.apache.activemq:activemq-kahadb-store:5.11.1')
        compile("mysql:mysql-connector-java:5.1.35")
        compile("org.hibernate:hibernate-entitymanager:4.3.8.Final")
        compile("org.hibernate:hibernate-core:4.3.8.Final")
        compile('org.springframework:spring-orm:4.1.6.RELEASE')
        compile('commons-dbcp:commons-dbcp:1.4')

        testCompile("org.springframework.boot:spring-boot-starter-data-jpa:1.2.3.RELEASE")
        testCompile('org.hsqldb:hsqldb:2.3.2')
        testCompile("junit:junit:4.9")
        testCompile("org.springframework:spring-test:4.1.6.RELEASE")
        testCompile("org.mockito:mockito-core:1.9.5")
    }
}

subprojects {
    //Put instructions for each sub project
}


// tag::repositories[]
// end::repositories[]

// Tasks

cobertura {
    rootProject.subprojects.each {
        coverageDirs << file("${it.name}/build/classes/main")
    }
}

bootRun{
    standardInput = System.in
}

test {
    testLogging.showStandardStreams = true
}

// tag::jar[]
jar {
    baseName = 'neutrino'
    appendix = ''
    classifier = ''
    version = ''
}
// end::jar[]

// tag::dependencies[]

dependencies {
    compile project(':main')
}

// end::dependencies[]

// tag::wrapper[]
task wrapper(type: Wrapper) {
    gradleVersion = '2.4'
}
// end::wrapper[]

release {
    failOnCommitNeeded = true	        // Fail the release process when there un-committed changes
    failOnPublishNeeded = true	        // Fail when there are local commits that haven't been published upstream (DVCS support)
    failOnSnapshotDependencies = true	// Fail when the project has dependencies on SNAPSHOT versions
    failOnUnversionedFiles = true	    // Fail when files are found that are not under version control
    failOnUpdateNeeded = true	        // Fail when the source needs to be updated, or there are changes available upstream that haven't been pulled
    revertOnFail = true	                // When a failure occurs should the plugin revert it's changes to gradle.properties?
}

/*
 * Gets the version name from the latest Git tag
 */
def getVersionName = { ->
    def stdout = new ByteArrayOutputStream()
    exec {
        commandLine 'git', 'describe', '--tags'
        standardOutput = stdout
    }
    return stdout.toString().trim()
}

task getVersion {
    task -> println "Neutrino v$project.version"
}